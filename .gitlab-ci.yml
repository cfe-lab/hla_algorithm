variables:
  PYTHON_VERSION:
    value: "3.7"
    options:
      - "3.7"
      - "3.8"
      - "3.9"
      - "3.10"
      - "3.11"
    description: Python version to use

stages:
  - precheck
  - test
  - build

Check-For-Black:
  stage: precheck
  image: black
  script:
    - cd $CI_PROJECT_DIR
    - black --check src/
  allow_failure: false
  rules:
    - if: $CI_JOB_MANUAL
    - if: $CI_PIPELINE_SOURCE == 'merge_request_event'
      changes:
        - src/**/*.py

Check-HLA-Modified-Dates:
  stage: precheck
  image: python:${PYTHON_VERSION}-slim
  before_script:
    - apt update
    - apt install git-restore-mtime -y --no-install-recommends
    - pip install typer
  script:
    - cd $CI_PROJECT_DIR
    - python src/easyhla/check_date_modified.py check-dates
  allow_failure: false
  rules:
    - if: $CI_JOB_MANUAL
    - if: $CI_PIPELINE_SOURCE == 'merge_request_event'
      changes:
        - src/**/*.csv
        - src/**/*.mtime
